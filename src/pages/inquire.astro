---
import Base from '../layouts/Base.astro';
---

<Base title="Inquire" description="What needs to be done?">
  <div class="inquire-page">
    <div id="inquire-form" class="form-container">
      <h1>What needs to be done?</h1>

      <form id="the-form">
        <textarea
          id="message"
          name="message"
          placeholder="Tell me about it..."
          rows="8"
          required
        ></textarea>

        <div id="drop-zone" class="drop-zone">
          <input type="file" id="file-input" multiple hidden />
          <div class="drop-zone-text">
            <span class="drop-icon">ðŸ“Ž</span>
            <span>Drop files here or <button type="button" id="browse-btn" class="browse-link">browse</button></span>
          </div>
          <div id="file-list" class="file-list"></div>
        </div>

        <button type="submit" class="submit-btn">Submit</button>
      </form>
    </div>

    <div id="inquire-thanks" class="thanks-container" style="display: none;">
      <h1>Thanks!</h1>
      <p>I'll let you know what I think shortly.</p>
    </div>
  </div>
</Base>

<script is:inline>
  document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('the-form');
    const formContainer = document.getElementById('inquire-form');
    const thanksContainer = document.getElementById('inquire-thanks');
    const dropZone = document.getElementById('drop-zone');
    const fileInput = document.getElementById('file-input');
    const browseBtn = document.getElementById('browse-btn');
    const fileList = document.getElementById('file-list');

    let attachedFiles = [];

    // Browse button
    browseBtn.addEventListener('click', () => fileInput.click());

    // File input change
    fileInput.addEventListener('change', (e) => {
      addFiles(e.target.files);
    });

    // Drag and drop
    dropZone.addEventListener('dragover', (e) => {
      e.preventDefault();
      dropZone.classList.add('drag-over');
    });

    dropZone.addEventListener('dragleave', () => {
      dropZone.classList.remove('drag-over');
    });

    dropZone.addEventListener('drop', (e) => {
      e.preventDefault();
      dropZone.classList.remove('drag-over');
      addFiles(e.dataTransfer.files);
    });

    function addFiles(files) {
      for (const file of files) {
        attachedFiles.push(file);
      }
      renderFileList();
    }

    function renderFileList() {
      fileList.innerHTML = attachedFiles.map((f, i) =>
        '<div class="file-item">' +
          '<span>' + f.name + ' <small>(' + formatSize(f.size) + ')</small></span>' +
          '<button type="button" class="remove-file" data-idx="' + i + '">Ã—</button>' +
        '</div>'
      ).join('');

      fileList.querySelectorAll('.remove-file').forEach(btn => {
        btn.addEventListener('click', () => {
          attachedFiles.splice(parseInt(btn.dataset.idx), 1);
          renderFileList();
        });
      });
    }

    function formatSize(bytes) {
      if (bytes < 1024) return bytes + ' B';
      if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
      return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
    }

    // Submit
    form.addEventListener('submit', (e) => {
      e.preventDefault();
      // For now, just show the thanks message
      // TODO: wire up to an actual endpoint (email, webhook, etc.)
      formContainer.style.display = 'none';
      thanksContainer.style.display = 'flex';
    });
  });
</script>

<style>
  .inquire-page {
    min-height: 70vh;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 3rem 0;
  }

  .form-container, .thanks-container {
    width: 100%;
    max-width: 560px;
  }

  .thanks-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
  }

  h1 {
    font-size: 1.8rem;
    font-weight: 700;
    letter-spacing: -0.02em;
    margin-bottom: 2rem;
  }

  .thanks-container h1 {
    font-size: 2.5rem;
    margin-bottom: 0.75rem;
  }

  .thanks-container p {
    color: var(--text-muted);
    font-size: 1.1rem;
  }

  form {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  textarea {
    width: 100%;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 1rem;
    color: var(--text);
    font-family: var(--font-sans);
    font-size: 0.95rem;
    line-height: 1.6;
    resize: vertical;
    transition: border-color 0.2s;
  }

  textarea:focus {
    outline: none;
    border-color: var(--accent);
  }

  textarea::placeholder {
    color: var(--text-dim);
  }

  .drop-zone {
    background: var(--surface);
    border: 2px dashed var(--border);
    border-radius: 10px;
    padding: 1.25rem;
    text-align: center;
    transition: all 0.2s;
    cursor: pointer;
  }

  .drop-zone:hover, .drop-zone.drag-over {
    border-color: var(--accent);
    background: var(--accent-glow);
  }

  .drop-zone-text {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    color: var(--text-muted);
    font-size: 0.85rem;
  }

  .drop-icon {
    font-size: 1.2rem;
  }

  .browse-link {
    background: none;
    border: none;
    color: var(--accent);
    cursor: pointer;
    font-size: 0.85rem;
    font-family: var(--font-sans);
    padding: 0;
    text-decoration: underline;
  }

  .file-list {
    margin-top: 0.5rem;
  }

  .file-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0.35rem 0;
    font-size: 0.8rem;
    color: var(--text-muted);
    border-top: 1px solid var(--border-subtle);
  }

  .file-item:first-child {
    margin-top: 0.5rem;
  }

  .file-item small {
    color: var(--text-dim);
  }

  .remove-file {
    background: none;
    border: none;
    color: var(--text-dim);
    cursor: pointer;
    font-size: 1.1rem;
    padding: 0 0.25rem;
    line-height: 1;
  }

  .remove-file:hover {
    color: var(--red);
  }

  .submit-btn {
    align-self: flex-end;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 8px;
    color: var(--text);
    padding: 0.6rem 2rem;
    font-size: 0.9rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s;
    font-family: var(--font-sans);
  }

  .submit-btn:hover {
    border-color: var(--accent);
    background: var(--accent-glow);
  }
</style>
