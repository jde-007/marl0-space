---
import Base from '../../layouts/Base.astro';
import { getCollection } from 'astro:content';

const capabilities = (await getCollection('capabilities')).sort(
  (a, b) => (a.data.order ?? 99) - (b.data.order ?? 99)
);
const experiences = (await getCollection('experiences')).sort(
  (a, b) => (a.data.order ?? 99) - (b.data.order ?? 99)
);
const learnings = (await getCollection('learnings')).sort(
  (a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime()
);

const categoryLabels: Record<string, string> = {
  build: 'Build',
  lead: 'Lead',
  operate: 'Operate',
  think: 'Think',
  amplify: 'Amplify',
};

const categoryColors: Record<string, string> = {
  build:   '#818cf8',
  lead:    '#34d399',
  operate: '#fbbf24',
  think:   '#f472b6',
  amplify: '#38bdf8',
};
---

<Base title="Capabilities" description="What one person with the right tools can actually do.">
  <section class="hero">
    <h1>Capabilities</h1>
    <p class="hero-sub">What one person with the right tools can actually do.</p>
  </section>

  <!-- Capabilities -->
  <section class="section">
    <h2 class="section-title">What I Can Do</h2>
    <div class="caps-stack">
      {capabilities.map((cap) => (
        <div class="cap-card" style={`--cat-color: ${categoryColors[cap.data.category]}`}>
          <div class="cap-header">
            <span class="cap-icon">{cap.data.icon}</span>
            <div class="cap-header-text">
              <h3>{cap.data.title}</h3>
              <span class="cap-category" style={`color: ${categoryColors[cap.data.category]}`}>
                {categoryLabels[cap.data.category]}
              </span>
            </div>
            {cap.data.stat && (
              <div class="cap-stat">
                <span class="stat-value" style={`color: ${categoryColors[cap.data.category]}`}>{cap.data.stat}</span>
                <span class="stat-label">{cap.data.statLabel}</span>
              </div>
            )}
          </div>
          {cap.data.tagline && (
            <p class="cap-tagline">{cap.data.tagline}</p>
          )}
          <div class="cap-body" set:html={cap.body} />
        </div>
      ))}
    </div>
  </section>

  <!-- Experience Timeline -->
  <section class="section">
    <h2 class="section-title">Where I've Done It</h2>
    <p class="not-looking">Not currently looking — but if something's looking for me, <a href="mailto:davidjerwin@gmail.com">let's talk</a>.</p>
    <div class="timeline">
      {experiences.map((exp) => (
        <div class="timeline-item">
          <div class="timeline-dot"></div>
          <div class="timeline-content">
            <div class="timeline-header">
              <div>
                <h3>{exp.data.role}</h3>
                <span class="timeline-org">{exp.data.org}</span>
              </div>
              <time class="timeline-period">{exp.data.period}</time>
            </div>
            <div class="timeline-body" set:html={exp.body} />
            {exp.data.tags && (
              <div class="timeline-tags">
                {exp.data.tags.map((t: string) => <span class="tag">{t}</span>)}
              </div>
            )}
          </div>
        </div>
      ))}
    </div>
  </section>

  <!-- Learnings -->
  <section class="section">
    <h2 class="section-title">What I've Learned</h2>
    <p class="section-intro">
      Distilled from building things. This section grows over time.
    </p>
    <div class="learnings-list">
      {learnings.map((learning) => (
        <div class="learning-card">
          <h3>"{learning.data.title}"</h3>
          <div class="learning-meta">
            <time>{learning.data.date}</time>
            <span class="learning-divider">·</span>
            <span class="learning-source">{learning.data.source}</span>
          </div>
          <div class="learning-body" set:html={learning.body} />
        </div>
      ))}
    </div>
  </section>

  <section class="section cta">
    <p>
      This page is alive. Capabilities get refined, experiences get deepened through interviews,
      and learnings accumulate. Check back — it only gets richer.
    </p>
  </section>
</Base>

<style>
  .hero {
    padding: 3rem 0 2rem;
  }

  .hero h1 {
    font-size: 2.5rem;
    font-weight: 700;
    letter-spacing: -0.02em;
  }

  .hero-sub {
    color: var(--text-muted);
    font-size: 1rem;
    margin-top: 0.25rem;
  }

  .section {
    padding: 2rem 0;
  }

  .section-title {
    font-size: 0.8rem;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: var(--text-muted);
    margin-bottom: 1.25rem;
  }

  .section-intro {
    color: var(--text-muted);
    font-size: 0.9rem;
    margin-bottom: 1.25rem;
    max-width: 560px;
  }

  /* === Capabilities Stack === */
  .caps-stack {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
  }

  .cap-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 1.5rem;
    transition: border-color 0.2s;
  }

  .cap-card:hover {
    border-color: var(--cat-color);
  }

  .cap-header {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 0.5rem;
  }

  .cap-icon {
    font-size: 1.5rem;
  }

  .cap-header-text {
    flex: 1;
  }

  .cap-header-text h3 {
    font-size: 1.05rem;
    font-weight: 600;
  }

  .cap-category {
    font-size: 0.7rem;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    font-weight: 600;
  }

  .cap-stat {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    flex-shrink: 0;
  }

  .stat-value {
    font-family: var(--font-mono);
    font-size: 1.4rem;
    font-weight: 700;
    letter-spacing: -0.02em;
    line-height: 1;
  }

  .stat-label {
    font-size: 0.6rem;
    color: var(--text-dim);
    text-align: right;
    max-width: 120px;
    line-height: 1.3;
    margin-top: 0.15rem;
  }

  .cap-tagline {
    font-size: 0.85rem;
    color: var(--text-muted);
    font-style: italic;
    margin-bottom: 0.75rem;
    line-height: 1.5;
  }

  .cap-body {
    font-size: 0.88rem;
    line-height: 1.7;
    color: var(--text-muted);
  }

  .cap-body :global(ul) {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .cap-body :global(li) {
    position: relative;
    padding-left: 1.1rem;
    margin-bottom: 0.25rem;
  }

  .cap-body :global(li)::before {
    content: '›';
    position: absolute;
    left: 0;
    color: var(--cat-color);
    font-weight: 700;
    font-size: 1rem;
  }

  .cap-body :global(strong) {
    color: var(--text);
    font-weight: 600;
  }

  .cap-body :global(p) {
    margin-bottom: 0.5rem;
  }

  /* === Timeline === */
  .not-looking {
    color: var(--text-dim);
    font-size: 0.9rem;
    font-style: italic;
    margin-bottom: 1.5rem;
  }

  .not-looking a {
    color: var(--accent);
  }

  .timeline {
    position: relative;
    padding-left: 2rem;
  }

  .timeline::before {
    content: '';
    position: absolute;
    left: 7px;
    top: 8px;
    bottom: 8px;
    width: 2px;
    background: var(--border);
  }

  .timeline-item {
    position: relative;
    margin-bottom: 1.5rem;
  }

  .timeline-dot {
    position: absolute;
    left: -2rem;
    top: 8px;
    width: 16px;
    height: 16px;
    border-radius: 50%;
    background: var(--surface);
    border: 2px solid var(--accent);
  }

  .timeline-content {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 1.25rem;
  }

  .timeline-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 1rem;
    margin-bottom: 0.5rem;
    flex-wrap: wrap;
  }

  .timeline-header h3 {
    font-size: 1rem;
    font-weight: 600;
  }

  .timeline-org {
    font-size: 0.85rem;
    color: var(--accent);
  }

  .timeline-period {
    font-size: 0.75rem;
    color: var(--text-dim);
    font-family: var(--font-mono);
    white-space: nowrap;
  }

  .timeline-body {
    font-size: 0.85rem;
    line-height: 1.7;
    color: var(--text-muted);
  }

  .timeline-body :global(p) {
    margin-bottom: 0.5rem;
  }

  .timeline-body :global(strong) {
    color: var(--text);
    font-weight: 600;
  }

  .timeline-body :global(ul) {
    padding-left: 1.25rem;
    margin-bottom: 0.5rem;
  }

  .timeline-body :global(li) {
    margin-bottom: 0.2rem;
  }

  .timeline-body :global(a) {
    color: var(--accent);
  }

  .timeline-body :global(em) {
    font-style: italic;
    color: var(--text-dim);
  }

  .timeline-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 0.3rem;
    margin-top: 0.75rem;
  }

  .tag {
    font-size: 0.65rem;
    padding: 0.1rem 0.4rem;
    background: var(--bg);
    border: 1px solid var(--border-subtle);
    border-radius: 999px;
    color: var(--text-dim);
  }

  /* === Learnings === */
  .learnings-list {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
  }

  .learning-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 1.25rem;
    border-left: 3px solid var(--accent);
  }

  .learning-card h3 {
    font-size: 1rem;
    font-weight: 600;
    font-style: italic;
    margin-bottom: 0.35rem;
    color: var(--text);
  }

  .learning-meta {
    display: flex;
    align-items: center;
    gap: 0.4rem;
    margin-bottom: 0.5rem;
  }

  .learning-meta time {
    font-size: 0.7rem;
    color: var(--text-dim);
    font-family: var(--font-mono);
  }

  .learning-divider {
    color: var(--text-dim);
    font-size: 0.7rem;
  }

  .learning-source {
    font-size: 0.7rem;
    color: var(--text-dim);
    font-style: italic;
  }

  .learning-body {
    font-size: 0.85rem;
    line-height: 1.7;
    color: var(--text-muted);
  }

  .learning-body :global(p) {
    margin-bottom: 0.5rem;
  }

  /* === CTA === */
  .cta {
    padding: 2rem 0 3rem;
    border-top: 1px solid var(--border-subtle);
    margin-top: 1rem;
  }

  .cta p {
    color: var(--text-dim);
    font-size: 0.9rem;
    font-style: italic;
    max-width: 560px;
  }

  @media (max-width: 600px) {
    .hero h1 { font-size: 2rem; }
    .timeline-header { flex-direction: column; gap: 0.25rem; }
    .timeline-period { align-self: flex-start; }
    .cap-header { flex-wrap: wrap; }
    .cap-stat { align-items: flex-start; flex-basis: 100%; flex-direction: row; gap: 0.4rem; margin-top: 0.25rem; }
    .stat-label { text-align: left; }
  }
</style>
